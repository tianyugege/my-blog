---
layout: '@/templates/BasePost.astro'
title: "我所理解的区块链和比特币"
description: "本文记录了初学web3以来对区块链及其特性的理解，用自己的语言描述出来能帮助我更好的掌握这些知识"
pubDate: "2024-05-30"
imgSrc: '/assets/images/image-post2.jpeg'
imgAlt: 'Image post 2'
---

本文记录了学习web3以来对区块链及其特性的理解，用自己的语言描述出来能帮助我更好的掌握这些知识

## 什么是区块链？

区块链的本质是一种特殊的数据存储结构，是一种通过链式结构链接的分布式账本技术。之所以称之为一种账本技术，是因为其核心功能是记录和验证数据的顺序和完整性，这类似于传统账本的作用。

区块链虽然目前在加密货币领域广为人知，但它适用于任何需要确保数据不可篡改的领域。

## 比特币和区块链的关系？

比特币是区块链技术的第一个成功应用场景。

### 如何理解比特币？

比特币是比特币系统的奖励

比特币就是很多人在同时做一个很难的数学题，谁先做出来，谁就获得一些奖励，这个奖励就是比特币。比特币根据系统规则产生，无法人为或者由某一个机构来控制发行。

## 区块链的结构

区块链收集交易信息并将其录入一个大小为4MB的文件中，这个文件被称为区块(block)。当区块被填满后，会将某些信息通过加密算法处理，生成一个称为区块头哈希值的十六进制数。

然后，这个哈希值被输入到下一个区块的区块头(block header)中，并与该区块头中的其他信息一起加密，从而形成区块链。

区块链最主要的特性是具有去中心化、不可修改、安全性。下文将着重介绍区块链的这三个特性

## 去中心化

去中心化是指将控制权和决策权从中心化实体（其中的个人、组织或团体）转让给分布式网络。例如传统的交易过程中必须会存在第三方机构，如银行、支付机构进行；在去中心化的网络中就不需要这些机构了，用户和用户之间可以直接进行交易。

### 区块链是如何实现去中心化的

1. 区块链使数据库中的数据能够分布在多个网络节点上（分布式账本），而不是某个单一的中央服务器，这些节点是运行区块链软件的计算机或设备，并位于不同的地理位置，所有节点都共同参与数据的记录和验证。
2. 每一个节点都有一份完整的账本记录，确保数据的一致性和完整性。
3. 每个节点都是平等的，没有主从之分，每个节点都能独立的验证交易和传播信息。

这意味着只要记录是真实有效的，就会自动同步到每个节点上，无需第三方的参与。（后文将介绍区块链系统是如何判断记录是否真实有效）。

## 不可修改性

区块链的不可修改性是指一个区块一旦被添加成功，包含该区块在内的其他区块的内容就不可能被更改。这一点又是如何做到的呢？

首先我们需要了解一下什么是哈希值和哈希函数。

### 什么是哈希值？

哈希值（Hash Value）是通过哈希函数（Hash Function）对数据进行处理后生成的一串固定长度的字符串。

哈希函数具有一些属性

通用属性：

- 通过“哈希”，将不论是何种大小的输入转化为固定大小的输出。
- 确定性：输入值一样，输出值就一样。
- 高效计算：短时间内计算完成（每秒几万亿次）

加密属性：

- 单向：只能用输入计算输出，无法根据输出倒推出输入
- 防碰撞：不可能出现2个不同的输入，但是输出的值相同，infeasible not impossible（理论上会出现2个输入对应相同的输出，1的40次方，但是在当前的环境和条件下不可能实现）
- 雪崩效应：输入值的微小差别，能带来输出值的巨大差异
- 迷宫友好性：知道输出值和部分输入值，也很难找到余下的输入值

接下来我们了解一下区块是如何被添加的？区块和区块之间又是如何连接起来的？

每个区块都是按照时间戳的顺序添加的，也就是说每个区块都是被添加到区块链的“末端”。每个区块头中都包含前一个区块所有内容的哈希值——SHA(前一个区块)，可以理解为每个区块的前哈希作为这个区块的指针。

### 区块链如何实现不可修改性

由于每个区块都包含前一个区块的哈希值，因此一个区块的变化会导致后续所有区块的哈希值发生变化。前文说道区块链中的每个节点都是平等的，保存的数据都是一致的，并且能够独立的验证交易和传播信息，因此，当某个节点的哈希值发生变化时，其他节点发现和自己的哈希值不匹配，就会阻止这个行为的发生。

## 安全性

前文说道只要信息是真实有效的，就会自动同步到区块链的节点上，那么如何保证信息是正确可靠的呢？当存在恶意或故障节点的情况下，区块链系统是如何应对的？确保同一笔加密货币不能被多次使用呢？

### 拜占庭将军问题

>一组拜占庭将军分别各率领一支军队共同围困一座城市。为了简化问题，将各支军队的行动策略限定为进攻或撤离两种。因为部分军队进攻部分军队撤离可能会造成灾难性后果，因此各位将军必须通过投票来达成一致策略，即所有军队一起进攻或所有军队一起撤离。因为各位将军分处城市不同方向，他们只能通过信使互相联系。在投票过程中每位将军都将自己投票给进攻还是撤退的信息通过信使分别通知其他所有将军，这样一来每位将军根据自己的投票和其他所有将军送来的信息就可以知道共同的投票结果而决定行动策略。
系统的问题在于，可能将军中出现叛徒，他们不仅可能向较为糟糕的策略投票，还可能选择性地发送投票信息。假设有9位将军投票，其中1名叛徒。8名忠诚的将军中出现了4人投进攻，4人投撤离的情况。这时候叛徒可能故意给4名投进攻的将领送信表示投票进攻，而给4名投撤离的将领送信表示投撤离。这样一来在4名投进攻的将领看来，投票结果是5人投进攻，从而发起进攻；而在4名投撤离的将军看来则是5人投撤离。这样各支军队的一致协同就遭到了破坏。
由于将军之间需要通过信使通讯，叛变将军可能通过伪造信件来以其他将军的身份发送假投票。而即使在保证所有将军忠诚的情况下，也不能排除信使被敌人截杀，甚至被敌人间谍替换等情况。

在采用分布式技术的计算机系统中，可以将问题中的将军映射为共同协作的节点，信使映射为各成员计算机赖以进行通讯的网络链路。我们将正常的节点叫做诚实节点，与之对应的就是有问题的节点（如网络链路出现错误、甚至被蓄意破坏者控制的节点）

因此我们这里讨论的是如何避免有问题的节点（即前文提到的“反叛的将军”）破坏数字货币系统里交易帐的正确性。

### 双花问题

>假设Alice在一个数字货币系统中有10个单位的加密货币（例如比特币）。Alice想要购买一件商品，她向商家Bob发送了10个单位的比特币作为支付。交易被广播到整个网络，并且最终确认（即被包含在一个区块中，并被区块链网络接受）。

然而，在这个过程中，Alice还有另一个计划：她几乎同时将同样的10个单位的比特币发送给了另一个商家Charlie，用来购买另一件商品。这种情况下，Alice企图进行了双花：同一笔比特币被她分别发送给了Bob和Charlie。

要解决这两个问题，我们需要引入一个概念——共识机制。

**共识机制（Consensus Mechanism）是通过特殊节点的投票，在很短的时间内完成对交易的验证和确认；对一笔交易，如果利益不相干的若干个节点能够达成共识，我们就可以认为全网对此也能够达成共识。**

### 共识机制解决拜占庭将军问题

解决这个问题的一种方法是让将军们通过计算解决一个复杂的数学问题来“证明”他们的忠诚。这个数学问题对于每个将军都是相同的，但是解决它需要耗费大量的计算资源。

现在，假设每个忠诚的将军都愿意参与解决这个数学问题，并且只有当他们解决了这个问题并且工作量被其他将军们验证通过后，才会发送自己的指令给其他将军。这样，其他将军们只有在收到足够多的来自忠诚将军的指令，并且这些指令都通过了验证后，才会达成共识。

叛徒将军要想破坏这个系统，需要控制大部分的计算资源，才能不让其他节点验证出问题。但是，由于解决这个数学问题需要大量的计算资源，这种攻击是非常困难和昂贵的。

这个“做题”的过程就是一种共识机制，叫做工作量证明（POW，proof of work），比特币系统就是用这种方式来保证系统的安全性的。

只有被验证通过的块才会被添加到链上，因此会存在一条最长链，也就是说这条链上被投入了最多的工作量——做了最多的题。

因此如果有人想要修改过去的某条交易记录，不仅需要将该块及其后的所有“题”全部重新做一遍，还要通过其他节点的验证，想要达到这个目的，除非掌握了整个网络上51%的计算资源（这就是51%攻击），难度可想而知。

### 共识机制解决双重支付问题

比特币区块链是第一个提出解决双重支付问题的去中心化方案，在此之前，人们只能通过信任第三方来防止双重支付问题。我们通过一个例子来看这个过程是如何做到的：

假设Alice有10个比特币，她试图用同样的5个比特币进行两笔不同的交易：

**交易1**：Alice向Bob发送5个比特币。

**交易2**：Alice向Charlie发送5个比特币。

1. **Alice创建两笔交易**：
    - Alice创建了交易1和交易2，并同时将这两笔交易广播到比特币网络。
2. **节点接收交易**：
    - 网络中的所有节点，包括矿工节点，会接收到这两笔交易，并将其暂时存储在内存池中。
3. **矿工验证交易**：
    - 矿工在选择交易打包进区块时，会验证每一笔交易的有效性。具体来说，矿工会检查Alice的余额是否足够，并检查每笔交易的输入是否已经被使用。
    - 由于交易1和交易2都尝试使用同样的5个比特币（相同的交易输入），矿工需要决定哪笔交易是有效的。
4. **矿工打包交易**：
    - 矿工A选择交易1，并将其打包进一个候选区块中，同时忽略交易2，因为交易2尝试使用的输入已经在交易1中使用。
    - 矿工B可能选择交易2并将其打包进一个候选区块中，同时忽略交易1。
5. **工作量证明**：
    - 矿工A和矿工B分别对他们的候选区块进行工作量证明（挖矿），竞争解决数学难题。
6. **新区块的传播**：
    - 矿工A首先成功解决难题，并将包含交易1的区块广播到整个网络。
    - 其他节点接收到矿工A的区块后，验证区块中的交易和工作量证明。
7. **节点处理新区块**：
    - 其他节点验证并添加矿工A的区块到他们的区块链中，此时交易1被确认。
8. **矿工B的区块处理**：
    - 矿工B可能在稍后完成了PoW，并将包含交易2的区块广播到网络。
    - 由于交易2尝试使用的输入（同样的5个比特币）已经在交易1中使用，网络节点会拒绝矿工B的区块。
9. **最终确认：**
    - 网络总是选择包含最多工作量证明的最长链作为有效链。矿工和节点会继续在矿工A的区块基础上挖矿。
    - 随着更多区块被添加到矿工A的链上，交易1得到更多确认，变得不可逆。

引用：

<https://www.investopedia.com/ask/answers/061915/how-does-block-chain-prevent-doublespending-bitcoins.asp>

<https://www.investopedia.com/terms/b/blockchain.asp>

<https://foresightnews.pro/article/detail/33875>

<https://www.coindesk.com/learn/what-is-a-consensus-mechanism/>

<https://ocw.mit.edu/courses/15-s12-blockchain-and-money-fall-2018/>
